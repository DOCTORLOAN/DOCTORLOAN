@{
    ViewData["Title"] = "Sản phẩm";
}

<link href="~/libs/flag/flag.css" rel="stylesheet" />
<div id="alert">
    @if (TempData["AlertMessageSuccess"] != null)
    {
        <div class="alert alert-success">
            @TempData["AlertMessageSuccess"]
        </div>
    }
</div>

<section id="ProductsBanner">
    <div class="swiper bannerProductSwiper">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="product-slider">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-3 col-md-5 col-12 order-lg-1 order-2">
                                <div class="center-thing">
                                    <div class="title-banner-product">
                                        Ghế nằm độc quyền sáng chế
                                        <span>DoctorLoan</span>
                                        <strong>135</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 col-12 order-lg-2 order-1">
                                <img class="img-product-banner" src="~/img/products/img-product-banner.png" />
                            </div>
                            <div class="col-lg-4 col-md-7 col-12 order-lg-3 order-3">
                                <div class="center-thing">
                                    <div class="info-banner">
                                        <h4>Nhà sáng chế - Bác Sĩ <strong>Phạm Thị Kim Loan</strong></h4>
                                        <h5>Sản phẩm được cấp bằng sáng chế độc quyền tại hơn <strong>60 quốc gia</strong></h5>
                                        <img class="img-bangsangche" src="~/img/license/ghe-nam.png" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="product-slider">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-3 col-md-5 col-12 order-lg-1 order-2">
                                <div class="center-thing">
                                    <div class="title-banner-product">
                                        Ghế ngồi độc quyền sáng chế
                                        <span>DoctorLoan</span>
                                        <strong>95 VIP</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 col-12 order-lg-2 order-1">
                                <img class="img-product-banner" src="~/img/products/product-95vip.png" />
                            </div>
                            <div class="col-lg-4 col-md-7 col-12 order-lg-3 order-3">
                                <div class="center-thing">
                                    <div class="info-banner">
                                        <h4>Nhà sáng chế - Bác Sĩ <strong>Phạm Thị Kim Loan</strong></h4>
                                        <h5>Sản phẩm được cấp bằng sáng chế độc quyền tại hơn <strong>60 quốc gia</strong></h5>
                                        <img class="img-bangsangche" src="~/img/license/ghe-ngoi.png" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="product-slider">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-3 col-md-5 col-12 order-lg-1 order-2">
                                <div class="center-thing">
                                    <div class="title-banner-product">
                                        Đệm thiền độc quyền sáng chế
                                        <span>DoctorLoan</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 col-12 order-lg-2 order-1">
                                <img class="img-product-banner" src="~/img/showroom/cushion-2.png" />
                            </div>
                            <div class="col-lg-4 col-md-7 col-12 order-lg-3 order-3">
                                <div class="center-thing">
                                    <div class="info-banner">
                                        <h4>Nhà sáng chế - Bác Sĩ <strong>Phạm Thị Kim Loan</strong></h4>
                                        <h5>Sản phẩm được cấp bằng sáng chế độc quyền tại hơn <strong>60 quốc gia</strong></h5>
                                        <img class="img-bangsangche" src="~/img/license/dem-thien.png" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-pagination"></div>
    </div>
</section>

<section class="product-info">
    <div class="container"></div>
</section>

<section id="ProductBestSeller" class="product-wrapper">
    <div class="container">
        <div class="title-product-info">Sản phẩm DOCTORLOAN <span>Sản phẩm được cấp bằng sáng chế độc quyền được bảo hộ trên 62 quốc gia</span></div>
        <div id="productItems" class="row justify-content-center"></div>
    </div>
</section>

<section id="CartMethod">
    <div class="container">
        <div class="list-method">
            <div class="method-item">
                <img src="~/img/icon/Delivery.svg" />
                <span>Chọn đơn vị vận chuyển</span>
            </div>
            <div class="method-item">
                <img src="~/img/icon/verify.svg" />
                <span>Đặt mua</span>
            </div>
            <div class="method-item">
                <img src="~/img/icon/call-center.svg" />
                <span>Hỗ trợ 24/7</span>
            </div>
            <div class="method-item">
                <img src="~/img/icon/Wallet.svg" />
                <span>Chọn hình thức thanh toán</span>
            </div>
            <div class="method-item">
                <img src="~/img/icon/settings.svg" />
                <span>Kiểm tra tình trạng đơn hàng</span>
            </div>
        </div>
    </div>
</section>

<section id="CollectionProducts">
    <div class="container">
        <div class="title-product-info text-left">Bộ sưu tập</div>
        <div class="row rowlg justify-content-center">
            <div class="col-xl-2 col-lg-3 col-md-4 col-6 collg col-20">
                <img src="~/img/products/collection-1.jpg" />
                <div class="title-collection">Sử dụng tại nhà</div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-4 col-6 collg col-20">
                <img src="~/img/products/collection-2.jpg" />
                <div class="title-collection">Sử dụng Văn phòng</div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-4 col-6 collg col-20">
                <img src="~/img/products/collection-3.jpg" />
                <div class="title-collection">Qùa tặng đối tác/ nhân viên</div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-4 col-6 collg col-20">
                <img src="~/img/products/collection-4.jpg" />
                <div class="title-collection">Qùa tặng người thân dịp lễ tết</div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-4 col-6 collg col-20">
                <img src="~/img/products/collection-5.jpg" />
                <div class="title-collection">Dùng trong phòng ngủ</div>
            </div>
        </div>
    </div>
</section>

<section class="product-info">
    <div class="container">
        <div class="product-info-main orange mb-0">
            <div class="row">
                <div class="col-lg-3 col-md-3 col-12">
                    <div class="center-thing">
                        <div class="title-pi">
                            Ghế độc quyền sáng chế
                            <span>DOCTORLOAN</span>
                            <strong>N85</strong>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-5 col-12">
                    <div class="img-pi">
                        <img src="~/img/products/product-n85-pink.png" />
                    </div>
                </div>
                <div class="col-lg-5 col-md-4 col-12">
                    <div class="center-thing">
                        <div class="title-pi-r">
                            <strong>SHOW ROOM SẢN PHẨM DOCTORLOAN</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.536753666197!2d106.68565887683472!3d10.770140589378318!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f3d2d233975%3A0x2d41ad8b4e102d26!2zOUEgVMO0biBUaOG6pXQgVMO5bmcsIFBoxrDhu51uZyBQaOG6oW0gTmfFqSBMw6NvLCBRdeG6rW4gMSwgVGjDoG5oIHBo4buRIEjhu5MgQ2jDrSBNaW5oLCBWaeG7h3QgTmFt!5e0!3m2!1svi!2s!4v1696662299725!5m2!1svi!2s" width=100% height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
</section>

@section scripts{
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#nav-menu-container ul li").removeClass("menu-active");
            $("#nav-menu-container ul li").eq(4).addClass("menu-active");
        });

        $('.btn-gr-dtl').click(function () {
            var parentbtn = $(this).parents(".chat-parent");
            parentbtn.find('.tile-project .btn-group .btn-gr-dtl').removeClass("btn-gr-active");
            $(this).addClass("btn-gr-active");
            var datachart = $(this).data("chart");

            parentbtn.find(".project-chart").removeClass("chart-active-home");
            parentbtn.find(".project-chart." + datachart).addClass("chart-active-home");
        });

        var bannerswiper = new Swiper(".bannerProductSwiper", {
            slidesPerView: 1,
            loop: true,
            autoplay: {
                delay: 3500,
                disableOnInteraction: false,
            },
            pagination: {
                el: ".swiper-pagination",
                clickable: true
            },
        });

        var swiper = new Swiper("#ProjectSwiper", {
            slidesPerView: 1,
            spaceBetween: 30,
            loop: true,
            autoplay: {
                delay: 2500,
                disableOnInteraction: false,
            },
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            }
        });

        var swiper2 = new Swiper("#ClientSwiper", {
            slidesPerView: 3,
            spaceBetween: 30,
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            breakpoints: {
                640: {
                    spaceBetween: 10
                },
                992: {
                    spaceBetween: 10
                },
                1200: {
                    spaceBetween: 30
                },
            },
        });

        var swiper3 = new Swiper("#ExperienceSwiper", {
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 2,
            initialSlide: 1,
            spaceBetween: 0,
            effect: 'coverflow',
            keyboard: true,
            slideToClickedSlide: true,
            loop: true,
            autoplay: {
                delay: 2500,
                disableOnInteraction: false,
            },
            coverflowEffect: {
                rotate: 0,
                stretch: 0,
                depth: 50,
                modifier: 6,
                slideShadows: false,
            },
            breakpoints: {
                768: {
                    slidesPerView: 3,
                    initialSlide: 2,
                    coverflowEffect: {
                        rotate: 0,
                        stretch: 0,
                        depth: 100,
                        modifier: 4,
                        slideShadows: false,
                    },
                }
            },
        });

        var swiper4 = new Swiper("#LicenseSwiper", {
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 3,
            initialSlide: 3,
            effect: 'coverflow',
            keyboard: true,
            slideToClickedSlide: true,
            coverflowEffect: {
                rotate: 0,
                stretch: 0,
                depth: 100,
                modifier: 4,
                slideShadows: false,
            },
            loop: true,
            autoplay: {
                delay: 2500,
                disableOnInteraction: false,
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            breakpoints: {
                640: {
                    spaceBetween: 40
                },
                992: {
                    spaceBetween: 80
                },
                1200: {
                    spaceBetween: 120
                },
            },
        });

        $(".dropdown-menu [data-bs-toggle='dropdown']").on("click", function (event) {
            event.preventDefault();
            event.stopPropagation();

            $(this).parents(".dropdown-menu").first().find(".show").removeClass("show");
            $(this).parents(".dropdown-menu").first().find("[aria-expanded='true']").attr("aria-expanded", false);

            $(this).attr("aria-expanded", true);
            $(this).siblings(".dropdown-menu").toggleClass("show");

            $(this)
                .parents(".nav-item.dropdown")
                .on("hidden.bs.dropdown", function (e) {
                    $(".dropdown-submenu .show").removeClass("show");
                    $(".dropdown-submenu [aria-expanded='true']").attr("aria-expanded", false);
                });
        });

        function redirectToWithData(url, data) {
            // Create query parameters obj data
            var queryParams = $.param(data);

            // Handle string query parameters in URL
            var redirectUrl = queryParams ? url + "?" + queryParams : url;

            // Redirect to Url
            window.location.href = redirectUrl;
        }

        //Handle get Product
        function getProduct() {
            $.ajax({
                url: 'https://doctorloan-api.giathaidoctorloan.vn/api/product-module/Product/FilterProducts',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    var _arr = [];
                    // Handle call API Products
                    $.each(data.data.items, function (idx, item) {
                        var productItem = $(`<div data-id="` + item.id + `" class="col-xl-2 col-lg-3 col-md-4 col-6 col-20">
                                                <div class="product-item" >
                                                    <div class="img-item" >
                                                        <div id="product-`+ item.id + `"></div>
                                                    </div>
                                                    <div class="content-item">
                                                        <h5><span>`+ item.name + `</span><strong>` + ((item.summary != undefined) ? item.summary : '') + `</strong> </h5>
                                                        <div id="price-item-`+ item.id + `" class="price-item">` + item.productItems[0].price + `</div>
                                                        <div class="action-item">
                                                            <a id="buy-`+ item.id + `" data-id="` + item.id + `" class="btn btn-buy" target="_blank">Mua ngay</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>`);
                        $("#productItems").append(productItem);

                        //Handle get img product
                        getImgProduct(item.id);

                        // Handle format currency vnd
                        $('#price-item-' + item.id).text(parseInt($('#price-item-' + item.id).text()).toLocaleString('vi', { style: 'currency', currency: 'VND' }));

                        // Handle seen details
                        $('#product-' + item.id).click(function () {
                            var data = {
                                productId: item.id,
                            };
                            redirectToWithData("/Products/ProductDetail", data);
                        });

                        /*
                        <a id="add-cart-`+ item.id + `" data-id="` + item.id + `" class="icon-cart"> <i class="fas fa-shopping-bag" > </i></a >
                        // Handle add to cart
                        $('body').on('click', '.price-item', function () {
                            const id = $(this).data('id');
                            alert("say hi!, ", id);
                        });
                        */

                        // Handle buy now
                        $("#buy-" + item.id).click(function () {
                            var data = {
                                id: item.id,
                                quantity: 1,
                            };
                            redirectToWithData("/Cart/Payment", data);
                        });
                    });

                },
                error: function (error) {
                    //handle show error
                    console.error('Error:', error);
                }
            });
        }

        getProduct();

        //Handle get Image Product for id
        function getImgProduct(id) {
            $.ajax({
                url: 'https://doctorloan-api.giathaidoctorloan.vn/api/product-module/Product/GetProduct?id=' + id,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    var flagN85, flag = false;
                    var gn_135 = 21;
                    var n85_id = 34;
                    var dt_id = 29;
                    var gcf5_id = 30;
                    var gcnl_id = 31;
                    var imgProduct;

                    $.each(data.data.categoryIds, function (idx, item) {
                        if (item === n85_id) {
                            flagN85 = true;
                        }
                        if (item === dt_id || item === gcf5_id || item === gcnl_id) {
                            flag = true;
                        }
                    });

                    if (data.data.productItems[0].productOptions != undefined && data.data.productItems[0].productOptions[0] != undefined && flag != true) {
                        var _arr = [];

                        $.each(data.data.productMedias, function (_idx, _item) {
                            if (flagN85 != true) {
                                if (_item.itemCode == data.data.sku + '-MAU NAU') {
                                    _arr.push(_item);
                                }
                            } else {
                                if (flagN85 == true && _item.itemCode == data.data.sku + '-MAU VANG-CHAN NGAN') {
                                    _arr.push(_item);
                                }
                            }
                        });

                        if (_arr[0] != undefined) {
                            $.each(_arr, function (_idx, _item) {
                                imgProduct = `<img src="` + _item.mediaUrl + `" />`;
                            });
                            $("#product-" + id).append(imgProduct);
                        }
                    } else {
                        var _arr = [];
                        $.each(data.data.productMedias, function (idx, item) {
                            _arr.push(item);
                        });

                        $.each(_arr, function (_idx, _item) {
                            imgProduct = `<img src="` + _item.mediaUrl + `" />`;
                        });
                        $("#product-" + id).append(imgProduct);
                    }
                },
                error: function (error) {
                    //handle show error
                    console.error('Error:', error);
                }
            });
        }

        window.setTimeout(function () {
            $("#alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 3000);

    </script>
}